import streamlit as st
import pandas as pd
import subprocess
import json

# Title of the App
st.title("Python Application Vulnerability Scanner")

# Instruction text
st.write("Upload your Python file to scan for vulnerabilities.")

# File uploader for Python code
uploaded_file = st.file_uploader("Choose a Python file", type=["py"])

if uploaded_file:
    # Save the uploaded file
    with open("uploaded_file.py", "wb") as f:
        f.write(uploaded_file.getbuffer())

    # Run Bandit on the uploaded file and get the report as JSON
    try:
        result = subprocess.run(
            ["bandit", "-r", "uploaded_file.py", "-f", "json"], capture_output=True, text=True
        )
        bandit_output = json.loads(result.stdout)

        # If Bandit found issues
        if bandit_output["results"]:
            # Extract relevant data for analysis
            data = {
                "Filename": [item["filename"] for item in bandit_output["results"]],
                "Issue": [item["issue_text"] for item in bandit_output["results"]],
                "Severity": [item["issue_severity"] for item in bandit_output["results"]],
                "Confidence": [item["issue_confidence"] for item in bandit_output["results"]],
                "Risk Score": [10 if item["issue_severity"] == "HIGH" else 5 for item in bandit_output["results"]],
            }

            df = pd.DataFrame(data)

            # Display the table of issues
            st.header("Vulnerability Report")
            st.dataframe(df)

            # Optionally, display the summary of risk scores
            st.header("Summary of Risk Scores")
            high_risk_count = df[df["Risk Score"] == 10].shape[0]
            medium_risk_count = df[df["Risk Score"] == 5].shape[0]
            st.write(f"Total High-Risk Issues: {high_risk_count}")
            st.write(f"Total Medium-Risk Issues: {medium_risk_count}")

        else:
            st.write("No vulnerabilities found!")
    except Exception as e:
        st.error(f"Error running Bandit: {str(e)}")

st.write("This app scans a Python file for security vulnerabilities using Bandit.")


